<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Encryption • ohcleandat</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Encryption">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ohcleandat</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/encryption.html">Encryption</a></li>
    <li><a class="dropdown-item" href="../articles/idcheck.html">ID Correction and Autobot</a></li>
    <li><a class="dropdown-item" href="../articles/integration.html">Integrating Different Datasets</a></li>
    <li><a class="dropdown-item" href="../articles/mechanics.html">Mechanics: Data Cleaning and Validation Pipeline</a></li>
    <li><a class="dropdown-item" href="../articles/metadata.html">Metadata: Creating Standard Metadata with `{ohcleandat}` and `{deposits}`</a></li>
    <li><a class="dropdown-item" href="../articles/outputs.html">Understanding The Pipeline Outputs</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Encryption</h1>
            
      

      <div class="d-none name"><code>encryption.Rmd</code></div>
    </div>

    
    
<p>Adapted from:</p>
<p>Collin Schwantes, Alix Augusto Armero Villanueva, Nathan Layman,
Kevin J. Olival, Ernest Guevarra, Evan Eskew, Maëlle Salmon, Shirley X.
Chen, &amp; Noam Ross. (2023). EHA Modeling &amp; Analytics Handbook
(v1.0.0). Zenodo. <a href="https://doi.org/10.5281/zenodo.8408552" class="external-link uri">https://doi.org/10.5281/zenodo.8408552</a></p>
<div class="section level3">
<h3 id="how-do-we-share-data-in-git-repositories-that-needs-to-be-secure">
<em>How do we share data in git repositories that needs to be
secure?</em><a class="anchor" aria-label="anchor" href="#how-do-we-share-data-in-git-repositories-that-needs-to-be-secure"></a>
</h3>
<p>Sometimes we need to store and share secure information, such as
passwords or API keys, to online service accounts. One of our methods of
choice for this is to keep these files stored in git/GitHub
repositories, but to encrypt them. We do this using PGP (Pretty Good
Privacy) encryption, implemented by the program <a href="https://github.com/AGWA/git-crypt" class="external-link"><code>git-crypt</code></a>. It
takes a bit to set up but once activated makes sharing secure and
seamless.</p>
<p>The PGP encryption scheme involves making a <em>public</em> key that
you share and a <em>private</em> key that you use to decrypt data
encrypted with your public key. We also use <a href="https://keybase.io/" class="external-link">Keybase</a>, a service that helps you publish
and verify a public key for this purpose.</p>
<div class="section level4">
<h4 id="tables-of-contents-for-encryption-set-up">Tables of Contents for Encryption Set up<a class="anchor" aria-label="anchor" href="#tables-of-contents-for-encryption-set-up"></a>
</h4>
<p><a href="#Windows">Set up for Windows</a></p>
<p><a href="#macos">Set up for macos</a></p>
<p><a href="#Linux">Set up for Linux</a></p>
<p><a href="#use">Storage, Use, and Mangement of GPG Keys</a></p>
</div>
</div>
<div class="section level2">
<h2 id="section">
<a id="Windows"></a><a class="anchor" aria-label="anchor" href="#section"></a>
</h2>
</div>
<div class="section level2">
<h2 id="windows">Windows<a class="anchor" aria-label="anchor" href="#windows"></a>
</h2>
<div class="section level4">
<h4 id="set-up-keybase-on-windows">Set up Keybase on Windows<a class="anchor" aria-label="anchor" href="#set-up-keybase-on-windows"></a>
</h4>
<p>Sign up for <a href="https://keybase.io/" class="external-link">Keybase</a>, and follow the
instructions for installing it on your computer.</p>
<p>Note that if you switch computers, you need to have another device
associated with the keybase account and/or a copy of your paper key in
order to recover your key.<br>
A <a href="https://www.theguardian.com/technology/2022/mar/19/not-using-password-manager-why-you-should-online-security" class="external-link">password
manager</a> like <a href="https://1password.com/" class="external-link">1Password</a> or <a href="https://bitwarden.com/" class="external-link">Bitwarden</a> would be helpful for
securely storing a paper key.</p>
</div>
<div class="section level4">
<h4 id="installing-keybase-on-windows">Installing Keybase on Windows<a class="anchor" aria-label="anchor" href="#installing-keybase-on-windows"></a>
</h4>
<p>For installing on Windows, the easiest way is to download and install
the graphical user interface available from the Keybase <a href="https://keybase.io/download" class="external-link">download page</a>. This will also
install the necessary command line tools.</p>
</div>
<div class="section level4">
<h4 id="install-gpg-and-git-crypt-on-windows">Install <code>gpg</code> and <code>git-crypt</code> on Windows<a class="anchor" aria-label="anchor" href="#install-gpg-and-git-crypt-on-windows"></a>
</h4>
<p><code>gpg</code> is the program that implements encryption, and
<code>git-crypt</code> sets up git repos for encrypted sharing using
<code>gpg.</code></p>
<p>For Windows there are two alternative approaches.</p>
</div>
<div class="section level4">
<h4 id="using-windows-subsystem-for-linux-wsl">Using Windows Subsystem for Linux (WSL)<a class="anchor" aria-label="anchor" href="#using-windows-subsystem-for-linux-wsl"></a>
</h4>
<p>The first approach is to utilize the Windows Subsystem for Linux
(WSL). This method requires Windows 10 or higher. You must first install
WSL. Do so following this guide: <a href="https://docs.microsoft.com/en-us/windows/wsl/install" class="external-link uri">https://docs.microsoft.com/en-us/windows/wsl/install</a>.</p>
<p>Once WSL is set up, the necessary packages can be installed through
the WSL command line shell. Run the following in the shell:</p>
<pre><code>sudo apt update
sudo apt install keybase gpg git-crypt</code></pre>
</div>
<div class="section level4">
<h4 id="using-windows-install-binaries">Using Windows: install binaries<a class="anchor" aria-label="anchor" href="#using-windows-install-binaries"></a>
</h4>
<p>The second method is to install pre-compiled Windows binaries for GPG
and git-crypt.</p>
<p>First download a Windows-compatible binary for GPG which can be found
(here)<a href="https://gnupg.org/download/" class="external-link uri">https://gnupg.org/download/</a>. The ‘Simple installer for
the current GnuPG’ binary on that page is the recommended choice.</p>
<p>Then install git-crypt by via the following steps:</p>
<ul>
<li>Downloading <code>git-crypt-*.exe</code> from <a href="https://github.com/AGWA/git-crypt/releases" class="external-link uri">https://github.com/AGWA/git-crypt/releases</a>.
<ul>
<li>This may generate the warning “git-crypt-*.exe is not commonly
downloaded and may be dangerous”. Click the up arrow next to ‘Discard’
and select ‘Keep’.</li>
<li>Even after this the download may fail with the message ‘Failed -
Virus detected’. Do not worry this is a false positive. If this occurs,
search for ‘Virus &amp; thread protection’ in the task bar and click on
‘Manage settings’ under ‘Virus &amp; thread protection settings’. Once
there, turn off “real-time protection” and try downloading again. Please
make sure to turn it back on again when done.</li>
</ul>
</li>
<li>Once downloaded, rename the file to <code>gpg-crypt.exe</code>.</li>
<li>Move the resulting <code>gpg-crypt.exe</code> into a folder
recognized by the Windows PATH environment variable. A convenient
location is <code>C:\Program Files\Git\cmd\</code>.</li>
</ul>
<p>Once Keybase and GPG are installed, the terminal commands related to
exporting keys from Keybase into GPG are the same regardless of
operating system.</p>
</div>
<div class="section level4">
<h4 id="create-your-keybase-keys-for-windows">Create your Keybase keys for Windows<a class="anchor" aria-label="anchor" href="#create-your-keybase-keys-for-windows"></a>
</h4>
<p>If you are just starting to use Keybase, you can generate new keys
for use on your computer using this guide: <a href="https://github.com/pstadler/keybase-gpg-github" class="external-link uri">https://github.com/pstadler/keybase-gpg-github</a>. That
guide also helps set up using your key to sign GitHub commits, which you
should do for added security.</p>
<p>Create a password associated with your keys when asked. You can store
this in your password manager such as 1Password or BitWarden. Once your
keys are created, visit your Keybase account at and verify your keys via
as many other services, devices, or online identities as you want. We
suggest at least three. It is also a good idea to generate a physical
‘paper key’ and store it in a secure location.</p>
</div>
<div class="section level4">
<h4 id="import-your-keys-to-your-local-keychain-for-windows">Import your keys to your local keychain for Windows<a class="anchor" aria-label="anchor" href="#import-your-keys-to-your-local-keychain-for-windows"></a>
</h4>
<p>If you have a Keybase account set and keys already generated, you can
now import your Keybase keys to use. Instruction are found at <a href="https://blog.scottlowe.org/2017/09/06/using-keybase-gpg-macos/" class="external-link uri">https://blog.scottlowe.org/2017/09/06/using-keybase-gpg-macos/</a>.
When followng those instructions, set your keys to maximum trust
level.</p>
</div>
<div class="section level4">
<h4 id="configure-gpg-for-windows">Configure gpg for Windows<a class="anchor" aria-label="anchor" href="#configure-gpg-for-windows"></a>
</h4>
<p>Windows needs to inform git of the location of the gpg executable.
This can be done by opening cmd or PowerShell and entering the following
command:</p>
<pre><code>git config --global gpg.program "C:\Program Files (x86)\GnuPG\bin\gpg.exe"</code></pre>
<p>Note that if GnuPG is installed in a different location the command
should be altered to reflect this change.</p>
</div>
</div>
<div class="section level2">
<h2 id="section-1">
<a id="Linux"></a><a class="anchor" aria-label="anchor" href="#section-1"></a>
</h2>
</div>
<div class="section level2">
<h2 id="linux">Linux<a class="anchor" aria-label="anchor" href="#linux"></a>
</h2>
<div class="section level4">
<h4 id="set-up-keybase-for-linux">Set up Keybase for Linux<a class="anchor" aria-label="anchor" href="#set-up-keybase-for-linux"></a>
</h4>
<p>Sign up for <a href="https://keybase.io/" class="external-link">Keybase</a>, and follow the
instructions for installing it on your computer.</p>
<p>Note that if you switch computers, you need to have another device
associated with the keybase account and/or a copy of your paper key in
order to recover your key.<br>
A <a href="https://www.theguardian.com/technology/2022/mar/19/not-using-password-manager-why-you-should-online-security" class="external-link">password
manager</a> like <a href="https://1password.com/" class="external-link">1Password</a> or <a href="https://bitwarden.com/" class="external-link">Bitwarden</a> would be helpful for
securely storing a paper key.</p>
</div>
<div class="section level4">
<h4 id="installing-keybase-on-linux">Installing Keybase on Linux<a class="anchor" aria-label="anchor" href="#installing-keybase-on-linux"></a>
</h4>
<p>For installing on linux, first identify the distribution by entering
the following command into a terminal and noting down the Distributor
ID.</p>
<pre><code><span><span class="va">lsb_release</span> <span class="op">-</span><span class="va">a</span></span></code></pre>
<p>Next identify the architecture via,</p>
<pre><code><span><span class="va">arch</span></span></code></pre>
<p>Follow the instructions to install Keybase on Linux, available <a href="https://keybase.io/docs/the_app/install_linux" class="external-link">here</a>, making
sure to use the section relevant to the architecture and distribution
information identified above.</p>
</div>
<div class="section level4">
<h4 id="install-gpg-and-git-crypt-for-linux">Install <code>gpg</code> and <code>git-crypt</code> for Linux<a class="anchor" aria-label="anchor" href="#install-gpg-and-git-crypt-for-linux"></a>
</h4>
<p><code>gpg</code> is the program that implements encryption, and
<code>git-crypt</code> sets up git repos for encrypted sharing using
<code>gpg.</code></p>
</div>
<div class="section level4">
<h4 id="create-your-keybase-keys-for-linux">Create your Keybase keys for Linux<a class="anchor" aria-label="anchor" href="#create-your-keybase-keys-for-linux"></a>
</h4>
<p>If you are just starting to use Keybase, you can generate new keys
for use on your computer using this guide: <a href="https://github.com/pstadler/keybase-gpg-github" class="external-link uri">https://github.com/pstadler/keybase-gpg-github</a>. That
guide also helps set up using your key to sign GitHub commits, which you
should do for added security.</p>
<p>Create a password associated with your keys when asked. You can store
this in your password manager such as 1Password or BitWarden. Once your
keys are created, visit your Keybase account at and verify your keys via
as many other services, devices, or online identities as you want. We
suggest at least three. It is also a good idea to generate a physical
‘paper key’ and store it in a secure location.</p>
</div>
<div class="section level4">
<h4 id="import-your-keys-to-your-local-keychain-for-linux">Import your keys to your local keychain for Linux<a class="anchor" aria-label="anchor" href="#import-your-keys-to-your-local-keychain-for-linux"></a>
</h4>
<p>If you have a Keybase account set and keys already generated, you can
now import your Keybase keys to use. Instruction are found at <a href="https://blog.scottlowe.org/2017/09/06/using-keybase-gpg-macos/" class="external-link uri">https://blog.scottlowe.org/2017/09/06/using-keybase-gpg-macos/</a>.
When followng those instructions, set your keys to maximum trust
level.</p>
</div>
<div class="section level4">
<h4 id="configure-gpg-on-linux">Configure gpg on Linux<a class="anchor" aria-label="anchor" href="#configure-gpg-on-linux"></a>
</h4>
<p>A common source of errors for Linux users is that the text entry for
<code>gpg</code> isn’t set properly. This means that <code>gpg</code>
and your terminal aren’t speaking the same language. You can fix this by
setting the <code>GPG_TTY</code> environment variable in your shell
configuration.</p>
<pre><code>export GPG_TTY=$(tty)</code></pre>
<p>Adding this to your <code>.profile</code>, <code>.bashrc</code>,
<code>.zshrc</code> or other settings files prevents having to run the
command when you use git-crypt or sign commits. U</p>
<p>Use a text editor to modify the settings file for your shell. These
are set in one of the files <code>~/.profile</code>,
<code>~/.bashrc</code>, <code>~/.zshrc</code>. For most macOS users, it
is <code>~/.zshrc</code>. Here are instructions using <code>nano</code>,
an editor available on most machines.</p>
<p>In the terminal, run:</p>
<pre><code>nano ~/.zshrc</code></pre>
<p>Then, in the nano text editor that comes up, add the following line
to the file:</p>
<pre><code>export GPG_TTY=$(tty)</code></pre>
<p>In the nano editor, press Ctrl-O to write (“write-Out”) to save your
changes, then press Ctrl-X to exit. Alternatively, run the following
line in the terminal to change your <code>.zshrc</code> file without
using nano or any other editor:</p>
<pre><code>echo "export GPG_TTY=$(tty)" &gt;&gt; ~/.zshrc &amp;&amp; source ~/.zshrc</code></pre>
</div>
</div>
<div class="section level2">
<h2 id="section-2">
<a id="macOS"></a><a class="anchor" aria-label="anchor" href="#section-2"></a>
</h2>
</div>
<div class="section level2">
<h2 id="macos">macOS<a class="anchor" aria-label="anchor" href="#macos"></a>
</h2>
<div class="section level4">
<h4 id="set-up-keybase-for-macos">Set up Keybase for macOS<a class="anchor" aria-label="anchor" href="#set-up-keybase-for-macos"></a>
</h4>
<p>Sign up for <a href="https://keybase.io/" class="external-link">Keybase</a>, and follow the
instructions for installing it on your computer.</p>
<p>Note that if you switch computers, you need to have another device
associated with the keybase account and/or a copy of your paper key in
order to recover your key.<br>
A <a href="https://www.theguardian.com/technology/2022/mar/19/not-using-password-manager-why-you-should-online-security" class="external-link">password
manager</a> like <a href="https://1password.com/" class="external-link">1Password</a> or <a href="https://bitwarden.com/" class="external-link">Bitwarden</a> would be helpful for
securely storing a paper key.</p>
</div>
<div class="section level4">
<h4 id="installing-keybase-on-macos">Installing Keybase on macOS<a class="anchor" aria-label="anchor" href="#installing-keybase-on-macos"></a>
</h4>
<p>For installing on macOS, the easiest way is to download and install
the graphical user interface available from the Keybase <a href="https://keybase.io/download" class="external-link">download page</a>. This will also
install the necessary command line tools.</p>
<p>You may also use <code>homebrew</code> to install keybase on
macOS</p>
</div>
<div class="section level4">
<h4 id="install-gpg-and-git-crypt-for-macos">Install <code>gpg</code> and <code>git-crypt</code> for macOS<a class="anchor" aria-label="anchor" href="#install-gpg-and-git-crypt-for-macos"></a>
</h4>
<p><code>gpg</code> is the program that implements encryption, and
<code>git-crypt</code> sets up git repos for encrypted sharing using
<code>gpg.</code></p>
<p>Use <a href="https://docs.brew.sh/Installation" class="external-link"><code>homebrew</code></a> to
install <code>gpg</code>, <code>git-crypt</code>. You should also
install <code>pinentry</code>, which is a helper program for entering
passwords securely. Run the following in the terminal:</p>
<pre><code>brew install gpg
brew install pinentry
brew install git-crypt</code></pre>
<p>Homebrew automatically updates when you run it so if you haven’t used
it in a while there may be a somewhat lengthy update</p>
</div>
<div class="section level4">
<h4 id="create-your-keybase-keys-for-macos">Create your Keybase keys for macOS<a class="anchor" aria-label="anchor" href="#create-your-keybase-keys-for-macos"></a>
</h4>
<p>If you are just starting to use Keybase, you can generate new keys
for use on your computer using this guide: <a href="https://github.com/pstadler/keybase-gpg-github" class="external-link uri">https://github.com/pstadler/keybase-gpg-github</a>. That
guide also helps set up using your key to sign GitHub commits, which you
should do for added security.</p>
<p>Create a password associated with your keys when asked. You can store
this in your password manager such as 1Password or BitWarden. Once your
keys are created, visit your Keybase account at and verify your keys via
as many other services, devices, or online identities as you want. We
suggest at least three. It is also a good idea to generate a physical
‘paper key’ and store it in a secure location.</p>
</div>
<div class="section level4">
<h4 id="import-your-keys-to-your-local-keychain-for-macos">Import your keys to your local keychain for macOS<a class="anchor" aria-label="anchor" href="#import-your-keys-to-your-local-keychain-for-macos"></a>
</h4>
<p>If you have a Keybase account set and keys already generated, you can
now import your Keybase keys to use. Instruction are found at <a href="https://blog.scottlowe.org/2017/09/06/using-keybase-gpg-macos/" class="external-link uri">https://blog.scottlowe.org/2017/09/06/using-keybase-gpg-macos/</a>.
When followng those instructions, set your keys to maximum trust
level.</p>
</div>
<div class="section level4">
<h4 id="configure-gpg-on-macos">Configure gpg on macOS<a class="anchor" aria-label="anchor" href="#configure-gpg-on-macos"></a>
</h4>
<p>A common source of errors for macOS users is that the text entry for
<code>gpg</code> isn’t set properly. This means that <code>gpg</code>
and your terminal aren’t speaking the same language. You can fix this by
setting the <code>GPG_TTY</code> environment variable in your shell
configuration.</p>
<pre><code>export GPG_TTY=$(tty)</code></pre>
<p>Adding this to your <code>.profile</code>, <code>.bashrc</code>,
<code>.zshrc</code> or other settings files prevents having to run the
command when you use git-crypt or sign commits. U</p>
<p>Use a text editor to modify the settings file for your shell. These
are set in one of the files <code>~/.profile</code>,
<code>~/.bashrc</code>, <code>~/.zshrc</code>. For most macOS users, it
is <code>~/.zshrc</code>. Here are instructions using <code>nano</code>,
an editor available on most machines.</p>
<p>In the terminal, run:</p>
<pre><code>nano ~/.zshrc</code></pre>
<p>Then, in the nano text editor that comes up, add the following line
to the file:</p>
<pre><code>export GPG_TTY=$(tty)</code></pre>
<p>In the nano editor, press Ctrl-O to write (“write-Out”) to save your
changes, then press Ctrl-X to exit. Alternatively, run the following
line in the terminal to change your <code>.zshrc</code> file without
using nano or any other editor:</p>
<pre><code>echo "export GPG_TTY=$(tty)" &gt;&gt; ~/.zshrc &amp;&amp; source ~/.zshrc</code></pre>
</div>
</div>
<div class="section level2">
<h2 id="storage-use-mangement-of-gpg-keys">
<a id="use"></a>Storage, Use, &amp; Mangement of GPG Keys<a class="anchor" aria-label="anchor" href="#storage-use-mangement-of-gpg-keys"></a>
</h2>
<div class="section level4">
<h4 id="backing-up-and-recovering-gpg-keys">Backing up and Recovering GPG Keys<a class="anchor" aria-label="anchor" href="#backing-up-and-recovering-gpg-keys"></a>
</h4>
<p>GPG private keys are stored locally and vulnerable to loss in the
event of a problem with a user’s local machine. There are two potential
ways to do this, and a belt-and-suspenders approach is best:</p>
<ol style="list-style-type: decimal">
<li>Use <a href="https://keybase.io/" class="external-link">KeyBase</a> to host an encrypted
version of the key.</li>
</ol>
<div class="float">
<img src="img/gpg_keybase_host_private_key.png" alt="host private key on keybase"><div class="figcaption">host private key on keybase</div>
</div>
<ol start="2" style="list-style-type: decimal">
<li>Store a copy of your private key in your password manager like <a href="https://1password.com/" class="external-link">1Password</a> or <a href="https://bitwarden.com/products/send/" class="external-link">Bitwarden</a>. <img src="img/gpg_1password_store_file.png" alt="Store an encrypted File in 1password">
</li>
</ol>
</div>
<div class="section level4">
<h4 id="how-do-i-save-a-key">How do I save a key?<a class="anchor" aria-label="anchor" href="#how-do-i-save-a-key"></a>
</h4>
<ul>
<li><p>First, do not commit the private key to github. Consider adding
<code>prv.key</code> to the <code>.gitignore</code> file.</p></li>
<li><p>Run the following commands to export public and private keys to
file:</p></li>
</ul>
<pre><code># Get list of keys on your machine. Replace USER NAME with the name associated with a listed key. 

gpg --list-keys

# Save private key to a file -- DO NOT COMMIT TO GITHUB
# You will prompted to enter your GPG password - its the same
# password you would enter to sign commits

 gpg --export-secret-key -a USER NAME &gt; prv.key

# Save public key to a file
 gpg --export -a USER NAME &gt; pub.key
 </code></pre>
<ul>
<li>Move private key to encrypted storage locations (e.g. keybase and
1password)</li>
<li>Delete the private key from your machine to avoid leaks</li>
</ul>
</div>
<div class="section level4">
<h4 id="how-do-i-recover-my-gpg-key-from-a-file">How do I recover my gpg key from a file?<a class="anchor" aria-label="anchor" href="#how-do-i-recover-my-gpg-key-from-a-file"></a>
</h4>
<p>First download the key from one of your back up locations.</p>
<p>Then run the following commands:</p>
<pre><code># import the key
gpg --import prv.key

# list keys to get public {KEY}

gpg --list-keys

# set the trust level

gpg --edit-key {KEY} trust quit
  # enter 5&lt;RETURN&gt; (I trust ultimately)
  # enter y&lt;RETURN&gt; (Really set this key to ultimate trust - Yes)

# list keys to check that your key is trusted

gpg --list-keys
</code></pre>
</div>
<div class="section level4">
<h4 id="use-git-crypt-to-unlock-a-repository">Use git-crypt to unlock a repository<a class="anchor" aria-label="anchor" href="#use-git-crypt-to-unlock-a-repository"></a>
</h4>
<p>The <a href="https://github.com/AGWA/git-crypt" class="external-link"><code>git-crypt</code>
README</a> outlines the basics of using <code>git-crypt</code> to
encrypted and decrypt files in a git repository.</p>
<p>First be sure your public key has been added to the repository. To do
this, check the <code>.git-crypt/keys/default/0</code> folder in the
github repo for your public key. If your key is present pull or clone
the repo then run,</p>
<pre><code>git-crypt unlock</code></pre>
<p>from the terminal or command line in the repository folder. If all
goes well, congrats! Encryption and decryption for pushing and pulling
should now happen automatically.</p>
</div>
<div class="section level4">
<h4 id="managing-which-users-can-decrypt-files-in-a-repository">Managing which users can decrypt files in a repository<a class="anchor" aria-label="anchor" href="#managing-which-users-can-decrypt-files-in-a-repository"></a>
</h4>
<p>The instructions below will help you go further by outlining how to
grant access to encrypted files on a repository and to initialize a new
repository to use git-crypt.</p>
</div>
<div class="section level4">
<h4 id="set-up-encryption-for-a-repo-that-did-not-previously-use-git-crypt">Set up encryption for a repo that did not previously use
git-crypt<a class="anchor" aria-label="anchor" href="#set-up-encryption-for-a-repo-that-did-not-previously-use-git-crypt"></a>
</h4>
<p>This will initialize the repository and add the default gpg key to
git-crypt. Note: adding encryption to a repository will only encrypt
files <em>going forward.</em> Any previous versions in the commit
history will still be un-encrypted. Best practice is to set up git-crypt
first, add relevant file or folder names to the
<code>.gitattributes</code> file, and only then add any sensitive files
to the repo.</p>
<pre><code>## In the repo base directory open the terminal or command line and enter:

git-crypt init

## To verify that files are being encrypted run:

git-crypt status

# add your key to git crypt
git-crypt add-gpg-user YOUR_KEY_HERE

# create .gitattributes file - will tell git crypt what should be encrypted
touch .gitattributes 

# tell git crypt that .env should be encrypted
echo '**/.env filter=git-crypt diff=git-crypt' &gt;&gt; .gitattributes 

# may also be a good idea to add **/auth  if you're going to be 
# using non-interactive processes with dropbox and google drive
echo 'auth/** filter=git-crypt diff=git-crypt' &gt;&gt; .gitattributes

</code></pre>
<p>To learn more about pattern matching in the
<code>.gitattributes</code> file, see the <a href="https://github.com/AGWA/git-crypt#gitattributes-file" class="external-link">git-crypt
read.me</a> and <a href="https://git-scm.com/docs/gitignore#_pattern_format" class="external-link">gitignore
manual</a></p>
<p>Your <code>.gitattributes</code> file might look something like
this:</p>
<pre><code>.env filter=git-crypt diff=git-crypt
auth/** filter=git-crypt diff=git-crypt
.gitattributes !filter !diff
</code></pre>
</div>
<div class="section level4">
<h4 id="give-contributors-access-to-encrypted-files">Give contributors access to encrypted files<a class="anchor" aria-label="anchor" href="#give-contributors-access-to-encrypted-files"></a>
</h4>
<p>First add their public key to your keychain. Visit their Keybase
profiles (e.g., <a href="https://keybase.io/noamross" class="external-link uri">https://keybase.io/noamross</a>) and click on the key - it
will show several ways to import the keys. Two methods are shown
below,</p>
<pre><code># curl + gpg pro tip: import noamross's keys
curl https://keybase.io/noamross/pgp_keys.asc | gpg --import

# the Keybase app can push to gpg keychain, too
keybase pgp pull noamross</code></pre>
<p>Next edit the key so that it has sufficient trust levels as described
in this <a href="https://blog.scottlowe.org/2017/09/06/using-keybase-gpg-macos/" class="external-link">guide</a>.</p>
<pre><code># in terminal

gpg --list-keys

## Copy the key that matches the individual you want to allow access to ecnrypted files. 

gpg --edit-key &lt;keyID&gt;

# At the gpg&gt; prompt, use uid X to select the user ID you want to mark as trusted,
# then use the trust command to set the trust level.
# Use save to exit when you’re done.

.</code></pre>
<p>Edit that key so that it has sufficient trust levels as described in
the above</p>
<p>Add the key to your git repo (make sure you’re in the right
directory)</p>
<pre><code>## this will automatically commit changes. Note: replace [key] below with the
appropriate gpg key.

git crypt add-gpg-user [key]
</code></pre>
<p>push changes to remote (github)</p>
<pre><code>git push
</code></pre>
<p>remind the added individual to pull these changes down before they
try to unlock the repo. The individual who was just added will have to
unlock the repo before they can access encrypted files.</p>
<pre><code>git crypt unlock</code></pre>
</div>
<div class="section level4">
<h4 id="use-a-symmetric-key-for-automated-processes">Use a symmetric key for automated processes<a class="anchor" aria-label="anchor" href="#use-a-symmetric-key-for-automated-processes"></a>
</h4>
<p>If you are using continuous integration on a repository with
encrypted files, you’ll need to provide a way for the CI system to
unlock them. An easy, but not <em>most</em> secure way is to provide a
<em>symmetric key</em>. You can generate this by running this in your
project directory. This key can always be regenerated so do NOT commit
it to your repository. In fact, it may be a good idea to add the key to
your <code>.gitignore</code>.</p>
<pre><code>git-crypt export-key git_crypt_key.key</code></pre>
<p><code>git_crypt_key.key</code> can now be used to decrypt the
repository, and you can provide it to the CI system as an environment
variable. However, since it is binary data, you’ll need to convert it to
base64 first.</p>
<p>To copy the key out of the <code>git_crypt_key.key</code>, run :</p>
<pre><code>cat git_crypt_key.key | base64 | pbcopy</code></pre>
<p>Then create a variable in your CI system’s environment called
<code>GIT_CRYPT_KEY64</code> and paste the <code>git_crypt_key</code>
value there. For github actions, see this <a href="https://docs.github.com/en/actions/security-guides/using-secrets-in-github-actions" class="external-link">article
on adding repository secrets</a>.</p>
<p>The key can now be removed from your system.</p>
<pre><code>rm git_crypt_key.key</code></pre>
<p>To use the key later, you’ll need (1) <code>git-crypt</code> and
<code>gpg</code> installed in the CI system image, and (2) to run these
commands after the CI clones your repository:</p>
<pre><code>echo $GIT_ENCRYPT_KEY64 &gt; git_crypt_key.key64 &amp;&amp; base64 -d git_crypt_key.key64 &gt; git_crypt_key.key &amp;&amp; git-crypt unlock git_crypt_key.key</code></pre>
</div>
<div class="section level4">
<h4 id="unlocking-encrypted-repos-with-a-symmetric-key">Unlocking encrypted repos with a Symmetric key<a class="anchor" aria-label="anchor" href="#unlocking-encrypted-repos-with-a-symmetric-key"></a>
</h4>
<p>[!CAUTION]</p>
<p><strong>Danger zone</strong>. This method makes key leak more likely
and should be avoided. Once a key leaks, there is no method for rotating
keys, so the leaked key would have to be scrubbed from the git history
and a new key put in its place.</p>
<p>Only share keys via secure methods like <a href="https://blog.1password.com/1password-file-document-sharing/" class="external-link">1password</a>
or <a href="https://bitwarden.com/products/send/" class="external-link">bitwarden</a>.</p>
<p>Sometimes its necessary to pass a symmetric key directly to a
collaborator.</p>
<p>Make sure <code>git_crypt_key.key</code> is in your
<code>.gitignore</code>.</p>
<p>In terminal, run the following code:</p>
<pre><code>## create key
git-crypt export-key git_crypt_key.key

## test key
git-crypt lock

git-crypt status
## try opening an encrypted file - it should error out

git-crypt unlock git_crypt_key.key
## try opening an encrypted file, it should work as expected. </code></pre>
<p>Send the file securely to your Collaborator. Your collaborator should
run:</p>
<pre><code>git-crypt unlock git_crypt_key.key</code></pre>
</div>
<div class="section level4">
<h4 id="removing-sensitive-files-from-git-history">Removing sensitive files from git history<a class="anchor" aria-label="anchor" href="#removing-sensitive-files-from-git-history"></a>
</h4>
<p>AKA What to do if you accidentally committed sensitive files (data,
keys, etc.) to your repository either before encryption or our outside
the scope of your <code>.gitattributes</code> file.</p>
<ol style="list-style-type: decimal">
<li>Take a breath.</li>
<li>Make sure your sensitive files are included either in the
<code>.gitattributes</code> file if you want them encrypted or delete
them then add them to your <code>.gitignore</code> file. You can add a
filter for particular files any where in your repo with
<code>**/MySuperSensitiveFile</code> see <a href="https://git-scm.com/docs/gitignore#_pattern_format" class="external-link">gitignore
documentation</a>
</li>
<li>Install <a href="https://github.com/newren/git-filter-repo/blob/main/INSTALL.md" class="external-link"><code>git-filter-repo</code></a>
</li>
<li>Navigate to your repo’s working directory
<code>cd my/project/folder</code>
</li>
<li>Back up your <code>.git/config</code> file as certain elements will
be removed when we run <code>git filter-repo</code>
</li>
<li>Run
<code>git filter-repo --invert-paths --path PATH-TO-YOUR-FILE-WITH-SENSITIVE-DATA</code>
to remove a sensitive file.</li>
<li>Make sure you’ve removed everything you want from the repository’s
history</li>
</ol>
<ul>
<li>use <code>git log -- path/to/file</code> to see git history for a
particular file. <strong>Note</strong> If you’ve successfully removed
the file there won’t be any history to display.<br>
</li>
<li>see <a href="https://git-scm.com/book/en/v2/Git-Basics-Viewing-the-Commit-History" class="external-link"><code>git log</code></a>
for more information.<br>
9)Check in with collaborators to make sure no one has work on branches
in the repo they would like to keep.<br>
</li>
</ul>
<ol start="10" style="list-style-type: decimal">
<li>Next you will use <code>push --force</code> to overwrite all the
history on github and all the branches on your repo. Push your changes
to the remote using <code>git push origin --force --all</code>.</li>
</ol>
<ul>
<li>You may have to add the origin back into your .git/config file</li>
</ul>
<ol start="11" style="list-style-type: decimal">
<li>Use <code>git push origin --force --tags</code> to remove sensitive
files from any of your tagged releases.</li>
<li>Follow the instructions <a href="https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/removing-sensitive-data-from-a-repository#fully-removing-the-data-from-github" class="external-link">here</a>
for contacting github to make sure there aren’t any caches of the files
on github.</li>
<li>Tell your collaborators to <code>rebase</code>,NOT MERGE, any
branches created off the old repo history.</li>
<li>Wait a little bit to make sure that your file remove didn’t have
unintended side effects then run the following code:</li>
</ol>
<pre><code>git for-each-ref --format="delete %(refname)" refs/original | git update-ref --stdin
git reflog expire --expire=now --all
git gc --prune=now</code></pre>
<ol start="10" style="list-style-type: decimal">
<li>Breathe a sigh of relief.</li>
</ol>
</div>
<div class="section level4">
<h4 id="troubleshooting">Troubleshooting<a class="anchor" aria-label="anchor" href="#troubleshooting"></a>
</h4>
<p>If <code>git-crypt unlock</code> fails, try the following steps:</p>
<ol style="list-style-type: decimal">
<li>Verify that GPG has successfully imported your private key from
Keybase by opening a shell and entering
<code>gpg --list-secret-keys</code>. If no keys are found, follow the <a href="https://blog.scottlowe.org/2017/09/06/using-keybase-gpg-macos/" class="external-link">guide</a>
for importing keys. This might fail for mac and linux users if
<code>export GPG_TTY=$(tty)</code> is not in your .bashrc or
.zshrc.</li>
<li>Make sure that your GPG private key has actually been added to the
repository. Navigate to the <code>~/.git-crypt/keys/default/0/</code>
directory on github and look for a file that matches your public
key.</li>
<li>After verifying your key is on the remote github repo, pull from the
remote to make sure the key is available to your local repository.</li>
<li>Windows users need to let git know where to find the gpg executable.
Double check that the gpg.exe really is in the folder you specified
above. If not find it’s location or try re-installing gpg.</li>
<li>Make sure that GIT <a href="https://docs.github.com/en/authentication/managing-commit-signature-verification/telling-git-about-your-signing-key#telling-git-about-your-gpg-key" class="external-link">knows
about your signing key</a>
</li>
</ol>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Collin Schwantes, Johana Teigen, Ernest Guevarra, Dean Marchiori, Melinda Rostal, EcoHealth Alliance.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
